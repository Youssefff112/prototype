<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Workout Assistant - FitCore</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/all.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html">
          <i class="fas fa-dumbbell"></i> FitCore
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-user-circle"></i> John Doe
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-user-cog me-2"></i> Profile Settings</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-bell me-2"></i> Notifications</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="index.html"
                    ><i class="fas fa-sign-out-alt me-2"></i> Logout</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="dashboard-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="mt-4">
          <a href="dashboard.html" class="sidebar-link">
            <i class="fas fa-home me-2"></i> Dashboard
          </a>
          <a href="workout-plan.html" class="sidebar-link">
            <i class="fas fa-calendar-alt me-2"></i> Workout Plan
          </a>
          <a href="diet-plan.html" class="sidebar-link">
            <i class="fas fa-utensils me-2"></i> Diet Plan
          </a>
          <a href="ai-assistant.html" class="sidebar-link active">
            <i class="fas fa-robot me-2"></i> AI Assistant
          </a>
          <a href="progress.html" class="sidebar-link">
            <i class="fas fa-chart-line me-2"></i> Progress
          </a>
          <a href="#" class="sidebar-link">
            <i class="fas fa-cog me-2"></i> Settings
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <h1 class="mb-4">
          <i class="fas fa-robot me-2"></i> AI Workout Assistant
        </h1>

        <div class="row g-4">
          <!-- Video Feed Section -->
          <div class="col-lg-8">
            <div class="ai-assistant-container">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h4 class="mb-0">
                  <i class="fas fa-video me-2"></i> Live Workout Session
                </h4>
                <div class="d-flex gap-2">
                  <button
                    class="btn btn-sm btn-outline-light"
                    id="cameraToggle"
                  >
                    <i class="fas fa-video"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-light" id="micToggle">
                    <i class="fas fa-microphone"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-light" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                  </button>
                </div>
              </div>

              <!-- Camera View -->
              <div class="camera-view" id="cameraView">
                <div
                  class="d-flex align-items-center justify-content-center h-100 flex-column text-white"
                >
                  <i class="fas fa-video-slash fa-5x mb-3 opacity-50"></i>
                  <h4>Camera Not Active</h4>
                  <p class="text-center">
                    Click "Start Workout" to begin your AI-assisted session
                  </p>
                  <canvas id="poseCanvas" class="pose-overlay d-none"></canvas>
                </div>
              </div>

              <!-- Exercise Info -->
              <div class="mt-3 p-3 bg-dark rounded" id="exerciseInfo">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-1 text-white">
                      Current Exercise:
                      <span class="text-primary" id="currentExercise"
                        >Select an exercise</span
                      >
                    </h5>
                    <p class="mb-0 text-light">
                      <span id="exerciseDetails"
                        >Choose an exercise from the list to start</span
                      >
                    </p>
                  </div>
                  <div class="text-end">
                    <h2 class="mb-0 text-success" id="repCounter">0</h2>
                    <small class="text-light">Reps</small>
                  </div>
                </div>
              </div>

              <!-- Control Buttons -->
              <div class="mt-3 d-flex gap-2">
                <button
                  class="btn btn-success flex-fill"
                  id="startBtn"
                  onclick="startWorkout()"
                >
                  <i class="fas fa-play me-2"></i> Start Workout
                </button>
                <button
                  class="btn btn-warning flex-fill d-none"
                  id="pauseBtn"
                  onclick="pauseWorkout()"
                >
                  <i class="fas fa-pause me-2"></i> Pause
                </button>
                <button
                  class="btn btn-danger flex-fill d-none"
                  id="stopBtn"
                  onclick="stopWorkout()"
                >
                  <i class="fas fa-stop me-2"></i> Stop
                </button>
              </div>
            </div>
          </div>

          <!-- Exercise Selection & Feedback -->
          <div class="col-lg-4">
            <!-- Exercise Selection -->
            <div class="feedback-panel mb-3">
              <h5 class="mb-3">
                <i class="fas fa-list me-2"></i> Today's Exercises
              </h5>
              <div class="list-group">
                <a
                  href="#"
                  class="list-group-item list-group-item-action"
                  onclick="selectExercise('Push-ups', '3 sets × 15 reps')"
                >
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <h6 class="mb-0">Push-ups</h6>
                      <small class="text-muted">3 sets × 15 reps</small>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                  </div>
                </a>
                <a
                  href="#"
                  class="list-group-item list-group-item-action"
                  onclick="selectExercise('Squats', '4 sets × 12 reps')"
                >
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <h6 class="mb-0">Squats</h6>
                      <small class="text-muted">4 sets × 12 reps</small>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                  </div>
                </a>
                <a
                  href="#"
                  class="list-group-item list-group-item-action"
                  onclick="selectExercise('Lunges', '3 sets × 10 reps')"
                >
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <h6 class="mb-0">Lunges</h6>
                      <small class="text-muted">3 sets × 10 reps</small>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                  </div>
                </a>
                <a
                  href="#"
                  class="list-group-item list-group-item-action"
                  onclick="selectExercise('Plank', '3 sets × 60 sec')"
                >
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <h6 class="mb-0">Plank</h6>
                      <small class="text-muted">3 sets × 60 sec</small>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                  </div>
                </a>
              </div>
            </div>

            <!-- Real-time Feedback -->
            <div class="feedback-panel">
              <h5 class="mb-3">
                <i class="fas fa-comment-dots me-2"></i> AI Feedback
              </h5>
              <div id="feedbackContainer">
                <div class="feedback-item success">
                  <i class="fas fa-check-circle"></i>
                  <div>
                    <strong>Good Form!</strong>
                    <p class="mb-0">Keep your back straight</p>
                  </div>
                </div>
                <div class="feedback-item warning">
                  <i class="fas fa-exclamation-triangle"></i>
                  <div>
                    <strong>Minor Adjustment</strong>
                    <p class="mb-0">Lower your hips slightly</p>
                  </div>
                </div>
                <div class="feedback-item error d-none">
                  <i class="fas fa-times-circle"></i>
                  <div>
                    <strong>Attention!</strong>
                    <p class="mb-0">Knees should not pass toes</p>
                  </div>
                </div>
              </div>

              <!-- Performance Metrics -->
              <div class="mt-3 pt-3 border-top border-secondary">
                <h6 class="mb-2">Session Stats</h6>
                <div class="d-flex justify-content-between mb-2">
                  <span>Form Accuracy:</span>
                  <strong class="text-success">92%</strong>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Duration:</span>
                  <strong id="duration">00:00</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span>Calories Burned:</span>
                  <strong class="text-warning" id="calories">0</strong>
                </div>
              </div>
            </div>

            <!-- Tips Card -->
            <div class="card mt-3 bg-info text-white border-0">
              <div class="card-body">
                <h6><i class="fas fa-lightbulb me-2"></i> Pro Tip</h6>
                <p class="mb-0 small">
                  Position yourself 6-8 feet from the camera for optimal pose
                  detection. Ensure good lighting and wear form-fitting clothes.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Features Info -->
        <div class="row g-4 mt-3">
          <div class="col-md-3">
            <div class="card text-center h-100 border-0 shadow-sm">
              <div class="card-body">
                <i class="fas fa-brain fa-3x text-primary mb-3"></i>
                <h5>Smart Detection</h5>
                <p class="small text-muted mb-0">
                  AI analyzes 33+ body points in real-time
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100 border-0 shadow-sm">
              <div class="card-body">
                <i class="fas fa-comment-alt fa-3x text-success mb-3"></i>
                <h5>Voice Feedback</h5>
                <p class="small text-muted mb-0">
                  Instant audio corrections during exercise
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100 border-0 shadow-sm">
              <div class="card-body">
                <i class="fas fa-shield-alt fa-3x text-warning mb-3"></i>
                <h5>Injury Prevention</h5>
                <p class="small text-muted mb-0">
                  Detect risky movements before they happen
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100 border-0 shadow-sm">
              <div class="card-body">
                <i class="fas fa-chart-line fa-3x text-danger mb-3"></i>
                <h5>Progress Tracking</h5>
                <p class="small text-muted mb-0">
                  Monitor improvements over time
                </p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/all.min.js"></script>
    <script src="../js/auth.js"></script>
    <script>
      let isWorkoutActive = false;
      let workoutTimer = null;
      let seconds = 0;
      let reps = 0;

      function selectExercise(name, details) {
        document.getElementById("currentExercise").textContent = name;
        document.getElementById("exerciseDetails").textContent = details;

        // Remove active class from all items
        document.querySelectorAll(".list-group-item").forEach((item) => {
          item.classList.remove("active");
        });

        // Add active class to selected item
        event.target.closest(".list-group-item").classList.add("active");

        // Reset counter
        reps = 0;
        document.getElementById("repCounter").textContent = reps;
      }

      function startWorkout() {
        if (
          !document
            .getElementById("currentExercise")
            .textContent.includes("Select")
        ) {
          isWorkoutActive = true;

          // Toggle buttons
          document.getElementById("startBtn").classList.add("d-none");
          document.getElementById("pauseBtn").classList.remove("d-none");
          document.getElementById("stopBtn").classList.remove("d-none");

          // Simulate camera activation
          document.querySelector("#cameraView .d-flex").classList.add("d-none");
          document.getElementById("poseCanvas").classList.remove("d-none");

          // Start timer
          workoutTimer = setInterval(() => {
            seconds++;
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById("duration").textContent = `${String(
              mins
            ).padStart(2, "0")}:${String(secs).padStart(2, "0")}`;

            // Simulate calories
            document.getElementById("calories").textContent = Math.floor(
              seconds * 0.15
            );

            // Simulate rep counting
            if (seconds % 3 === 0 && isWorkoutActive) {
              reps++;
              document.getElementById("repCounter").textContent = reps;
            }
          }, 1000);

          // Simulate AI feedback
          simulateFeedback();

          alert(
            "AI Workout started! In a real implementation:\n\n" +
              "• Your camera would activate\n" +
              "• AI would detect your body pose in real-time\n" +
              "• You would see skeleton overlay on your body\n" +
              "• Get real-time voice & visual feedback\n" +
              "• Automatic rep counting\n" +
              "• Form correction alerts"
          );
        } else {
          alert("Please select an exercise first!");
        }
      }

      function pauseWorkout() {
        isWorkoutActive = false;
        clearInterval(workoutTimer);

        const pauseBtn = document.getElementById("pauseBtn");
        if (pauseBtn.innerHTML.includes("Pause")) {
          pauseBtn.innerHTML = '<i class="fas fa-play me-2"></i> Resume';
        } else {
          isWorkoutActive = true;
          pauseBtn.innerHTML = '<i class="fas fa-pause me-2"></i> Pause';
          startWorkout();
        }
      }

      function stopWorkout() {
        isWorkoutActive = false;
        clearInterval(workoutTimer);

        // Reset UI
        document.getElementById("startBtn").classList.remove("d-none");
        document.getElementById("pauseBtn").classList.add("d-none");
        document.getElementById("stopBtn").classList.add("d-none");

        document
          .querySelector("#cameraView .d-flex")
          .classList.remove("d-none");
        document.getElementById("poseCanvas").classList.add("d-none");

        alert(
          `Workout Complete!\n\nDuration: ${
            document.getElementById("duration").textContent
          }\nTotal Reps: ${reps}\nCalories: ${
            document.getElementById("calories").textContent
          }\nForm Accuracy: 92%`
        );

        // Reset
        seconds = 0;
        reps = 0;
        document.getElementById("repCounter").textContent = "0";
      }

      function simulateFeedback() {
        // Simulate AI feedback appearing
        const feedbacks = [
          {
            type: "success",
            message: "Excellent form!",
            detail: "Keep it up!",
          },
          {
            type: "warning",
            message: "Small adjustment",
            detail: "Engage your core more",
          },
          {
            type: "success",
            message: "Perfect depth",
            detail: "Your squat depth is ideal",
          },
        ];

        setInterval(() => {
          if (isWorkoutActive) {
            const feedback =
              feedbacks[Math.floor(Math.random() * feedbacks.length)];
            // In real app, this would update the feedback panel
          }
        }, 5000);
      }

      // Simulate camera toggle
      document
        .getElementById("cameraToggle")
        .addEventListener("click", function () {
          this.classList.toggle("btn-outline-light");
          this.classList.toggle("btn-danger");
        });

      document
        .getElementById("micToggle")
        .addEventListener("click", function () {
          this.classList.toggle("btn-outline-light");
          this.classList.toggle("btn-danger");
        });

      // AUTH INTEGRATION
      Auth.requireLogin();
      const currentUser = Auth.getCurrentUser();
      if (currentUser) {
        const userDropdown = document.getElementById("userDropdown");
        if (userDropdown && userDropdown.textContent.includes("John Doe")) {
          userDropdown.innerHTML = `<i class="fas fa-user-circle"></i> ${currentUser.firstName} ${currentUser.lastName}`;
        }
      }

      // Logout handler
      const logoutLink = Array.from(
        document.querySelectorAll(".dropdown-item")
      ).find((el) => el.textContent.includes("Logout"));
      if (logoutLink) {
        logoutLink.addEventListener("click", function (e) {
          e.preventDefault();
          Auth.logout();
          window.location.href = "../index.html";
        });
      }
    </script>
  </body>
</html>
