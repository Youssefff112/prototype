<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - FitCore</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/all.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html">
          <i class="fas fa-dumbbell"></i> FitCore
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-user-circle"></i>
                <span class="user-name">User</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="settings.html"
                    ><i class="fas fa-user-cog me-2"></i> Profile Settings</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-bell me-2"></i> Notifications</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#" data-logout
                    ><i class="fas fa-sign-out-alt me-2"></i> Logout</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="dashboard-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="mt-4">
          <a href="dashboard.html" class="sidebar-link">
            <i class="fas fa-home me-2"></i> Dashboard
          </a>
          <a href="workout-plan.html" class="sidebar-link">
            <i class="fas fa-calendar-alt me-2"></i> Workout Plan
          </a>
          <a href="diet-plan.html" class="sidebar-link">
            <i class="fas fa-utensils me-2"></i> Diet Plan
          </a>
          <a href="gym-finder.html" class="sidebar-link" id="gymFinderLink">
            <i class="fas fa-search-location me-2"></i> Find Gyms
          </a>
          <a href="ai-assistant.html" class="sidebar-link" id="aiAssistantLink">
            <i class="fas fa-robot me-2"></i> AI Assistant
          </a>
          <a href="progress.html" class="sidebar-link">
            <i class="fas fa-chart-line me-2"></i> Progress
          </a>
          <a href="settings.html" class="sidebar-link active">
            <i class="fas fa-cog me-2"></i> Settings
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <h1 class="mb-4"><i class="fas fa-cog me-2"></i> Settings</h1>

        <!-- Profile Settings -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-user me-2"></i> Profile Information
            </h5>
          </div>
          <div class="card-body">
            <form id="profileForm">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstName"
                    value="John"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="lastName"
                    value="Doe"
                  />
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  value="user@fitcore.com"
                  readonly
                />
                <small class="text-muted">Email cannot be changed</small>
              </div>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">Age</label>
                  <input
                    type="number"
                    class="form-control"
                    id="age"
                    value="25"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Gender</label>
                  <select class="form-select" id="gender">
                    <option value="male" selected>Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Height (cm)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="height"
                    value="175"
                  />
                </div>
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-2"></i> Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Training Preferences -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-dumbbell me-2"></i> Training Preferences
            </h5>
          </div>
          <div class="card-body">
            <form id="trainingForm">
              <div class="mb-4">
                <label class="form-label">I want to train:</label>
                <div class="row g-3">
                  <div class="col-md-6">
                    <div
                      class="card border-primary h-100"
                      style="cursor: pointer"
                      onclick="selectTrainingType('onsite')"
                    >
                      <div class="card-body text-center">
                        <i class="fas fa-building fa-3x text-primary mb-3"></i>
                        <h5>At a Gym (On-site)</h5>
                        <p class="text-muted mb-0">
                          Access gym finder and on-site workout plans
                        </p>
                        <input
                          type="radio"
                          name="trainingType"
                          value="onsite"
                          id="onsiteRadio"
                          class="mt-3"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div
                      class="card border-success h-100"
                      style="cursor: pointer"
                      onclick="selectTrainingType('offline')"
                    >
                      <div class="card-body text-center">
                        <i class="fas fa-home fa-3x text-success mb-3"></i>
                        <h5>At Home (Offline)</h5>
                        <p class="text-muted mb-0">
                          Get AI workout assistant and home routines
                        </p>
                        <input
                          type="radio"
                          name="trainingType"
                          value="offline"
                          id="offlineRadio"
                          class="mt-3"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Fitness Goal</label>
                <select class="form-select" id="goal">
                  <option value="weight_loss">Weight Loss</option>
                  <option value="muscle_gain" selected>Muscle Gain</option>
                  <option value="maintenance">Maintenance</option>
                  <option value="endurance">Build Endurance</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Experience Level</label>
                <select class="form-select" id="experience">
                  <option value="beginner">Beginner</option>
                  <option value="intermediate" selected>Intermediate</option>
                  <option value="advanced">Advanced</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Workout Days Per Week</label>
                <select class="form-select" id="workoutDays">
                  <option value="3">3 days</option>
                  <option value="4">4 days</option>
                  <option value="5" selected>5 days</option>
                  <option value="6">6 days</option>
                </select>
              </div>

              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-2"></i> Update Preferences
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Diet Settings -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-utensils me-2"></i> Diet Preferences
            </h5>
          </div>
          <div class="card-body">
            <form id="dietForm">
              <div class="mb-3">
                <label class="form-label">Diet Type</label>
                <select class="form-select" id="dietType">
                  <option value="none" selected>No Restrictions</option>
                  <option value="vegetarian">Vegetarian</option>
                  <option value="vegan">Vegan</option>
                  <option value="keto">Keto</option>
                  <option value="paleo">Paleo</option>
                  <option value="gluten_free">Gluten-Free</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Allergies</label>
                <textarea
                  class="form-control"
                  id="allergies"
                  rows="2"
                  placeholder="List any food allergies..."
                ></textarea>
              </div>

              <div class="mb-3">
                <label class="form-label">Meals Per Day</label>
                <select class="form-select" id="mealsPerDay">
                  <option value="3">3 meals</option>
                  <option value="4">4 meals</option>
                  <option value="5" selected>5 meals</option>
                  <option value="6">6 meals</option>
                </select>
              </div>

              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save me-2"></i> Save Diet Settings
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Notification Settings -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0"><i class="fas fa-bell me-2"></i> Notifications</h5>
          </div>
          <div class="card-body">
            <div class="form-check form-switch mb-3">
              <input
                class="form-check-input"
                type="checkbox"
                id="emailNotifications"
                checked
              />
              <label class="form-check-label" for="emailNotifications">
                Email Notifications
              </label>
            </div>
            <div class="form-check form-switch mb-3">
              <input
                class="form-check-input"
                type="checkbox"
                id="workoutReminders"
                checked
              />
              <label class="form-check-label" for="workoutReminders">
                Workout Reminders
              </label>
            </div>
            <div class="form-check form-switch mb-3">
              <input
                class="form-check-input"
                type="checkbox"
                id="progressUpdates"
                checked
              />
              <label class="form-check-label" for="progressUpdates">
                Weekly Progress Updates
              </label>
            </div>
            <div class="form-check form-switch mb-3">
              <input
                class="form-check-input"
                type="checkbox"
                id="motivationalMessages"
              />
              <label class="form-check-label" for="motivationalMessages">
                Motivational Messages
              </label>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0"><i class="fas fa-lock me-2"></i> Security</h5>
          </div>
          <div class="card-body">
            <h6 class="mb-3">Change Password</h6>
            <form id="passwordForm">
              <div class="mb-3">
                <label class="form-label">Current Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="currentPassword"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">New Password</label>
                <input type="password" class="form-control" id="newPassword" />
              </div>
              <div class="mb-3">
                <label class="form-label">Confirm New Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="confirmPassword"
                />
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-warning">
                  <i class="fas fa-key me-2"></i> Change Password
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Danger Zone -->
        <div class="card shadow-sm border-danger mb-4">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">
              <i class="fas fa-exclamation-triangle me-2"></i> Danger Zone
            </h5>
          </div>
          <div class="card-body">
            <p class="text-muted">
              Once you delete your account, there is no going back. Please be
              certain.
            </p>
            <button class="btn btn-danger" onclick="deleteAccount()">
              <i class="fas fa-trash me-2"></i> Delete Account
            </button>
          </div>
        </div>
      </main>
    </div>

    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/all.min.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/main.js"></script>
    <script>
      // Protect page
      Auth.requireLogin();

      // Load user data
      const user = Auth.getCurrentUser();
      if (user) {
        document.getElementById("firstName").value = user.firstName || "";
        document.getElementById("lastName").value = user.lastName || "";
        document.getElementById("email").value = user.email || "";

        if (user.profile) {
          document.getElementById("age").value = user.profile.age || "";
          document.getElementById("gender").value =
            user.profile.gender || "male";
          document.getElementById("height").value = user.profile.height || "";
          document.getElementById("goal").value =
            user.profile.goal || "muscle_gain";
          document.getElementById("experience").value =
            user.profile.experience || "intermediate";
        }

        // Set training type
        if (user.userType) {
          document.getElementById(
            user.userType === "onsite" ? "onsiteRadio" : "offlineRadio"
          ).checked = true;
        }
      }

      function selectTrainingType(type) {
        document.getElementById(type + "Radio").checked = true;
        const user = Auth.getCurrentUser();
        if (user) {
          Auth.setUserType(user.id, type);
          alert(
            `Training type updated to: ${
              type === "onsite" ? "Gym Training" : "Home Training"
            }\n\nPage will reload to update navigation.`
          );
          location.reload();
        }
      }

      document
        .getElementById("profileForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const user = Auth.getCurrentUser();
          if (user) {
            const profileData = {
              age: parseInt(document.getElementById("age").value),
              gender: document.getElementById("gender").value,
              height: parseInt(document.getElementById("height").value),
            };
            Auth.updateProfile(user.id, profileData);
            alert("Profile updated successfully!");
          }
        });

      document
        .getElementById("trainingForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          alert("Training preferences updated successfully!");
        });

      document
        .getElementById("dietForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          alert("Diet preferences updated successfully!");
        });

      document
        .getElementById("passwordForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const current = document.getElementById("currentPassword").value;
          const newPass = document.getElementById("newPassword").value;
          const confirm = document.getElementById("confirmPassword").value;

          if (newPass !== confirm) {
            alert("New passwords do not match!");
            return;
          }

          alert(
            "Password changed successfully!\n\nIn production, this would:\n• Verify current password\n• Hash new password\n• Update in database\n• Send confirmation email"
          );
          this.reset();
        });

      function deleteAccount() {
        if (
          confirm(
            "Are you absolutely sure you want to delete your account?\n\nThis action cannot be undone and all your data will be permanently deleted."
          )
        ) {
          if (confirm("Final confirmation: Delete account?")) {
            alert(
              "Account deleted successfully.\n\nIn production, this would:\n• Delete all user data\n• Remove workout history\n• Cancel subscriptions\n• Send confirmation email"
            );
            Auth.logout();
          }
        }
      }
    </script>
  </body>
</html>
